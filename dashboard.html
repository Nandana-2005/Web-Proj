<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Market Dashboard</title>
  <link rel="stylesheet" href="dash.css">
</head>
<body>
  <div id="toast-container" class="toast-container"></div>
  
  <div class="dashboard">
    <aside class="sidebar">
        <div class="sidebar-logo">
          <div class="logo-circle">T</div>
          <span class="logo-text">Trade Plus</span>
        </div>
        
        <ul class="nav-links">
          <li class="nav-link active">
            <svg xmlns="http://www.w3.org/2000/svg" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span class="nav-text">Dashboard</span>
          </li>
          <li class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
            </svg>
            <span class="nav-text">Stocks</span>
          </li>
          <li class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span class="nav-text">F&O</span>
          </li>
          <li class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 2 L15.09 8.26 L22 9.27 L17 14.14 L18.18 21.02 L12 17.77 L5.82 21.02 L7 14.14 L2 9.27 L8.91 8.26 L12 2"></path>
            </svg>
            <span class="nav-text">Mutual Funds</span>
          </li>
          <li class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
              <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
            <span class="nav-text">Portfolio</span>
          </li>
          <li class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <span class="nav-text">News</span>
          </li>
        </ul>
        
        <div class="user-profile">
          <div class="user-avatar">JP</div>
          <div class="user-info">
            <span class="user-name">John Patel</span>
            <span class="user-status">Premium</span>
          </div>
        </div>
      </aside>
      
      <!-- Main Content -->
      <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
          <div class="search-bar">
            <svg xmlns="http://www.w3.org/2000/svg" class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" class="search-input" placeholder="Search for Stock Market...">
          </div>
          
          <button class="profile-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>Profile</span>
          </button>
        </div>
        
    
        
  
      <!-- Page Header with improved API status -->
      <div class="page-header">
        <h1 class="page-title">Stock Market</h1>
        <p class="page-subtitle">Trending Stock Market</p>
        
        <div class="api-status error" id="apiStatus">
          <svg xmlns="http://www.w3.org/2000/svg" class="api-status-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <span>Using fallback data. Real-time data not available.</span>
          <button id="retryButton" class="retry-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 2px;">
              <path d="M21 2v6h-6"></path>
              <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
              <path d="M3 22v-6h6"></path>
              <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
            </svg>
            Retry
          </button>
        </div>
      </div>
    
      <div class="market-indices">
        <!-- Index Card 1 -->
        <div class="market-card fade-in delay-100">
          <div class="market-header">
            <h3 class="market-title">NIFTY 50</h3>
            <div class="market-value">
              <span class="value-number">21,932.75</span>
              <span class="change-badge positive">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
                  <polyline points="16 7 22 7 22 13"></polyline>
                </svg>
                0.83%
              </span>
            </div>
          </div>
          
          <div class="chart-container">
            <svg width="120" height="40">
              <path d="M0,30 L10,28 L20,25 L30,26 L40,20 L50,15 L60,18 L70,14 L80,10 L90,8 L100,5 L110,2 L120,4" fill="none" stroke="#10B981" stroke-width="2"></path>
            </svg>
          </div>
          
          <div class="market-metrics">
            <div class="metric">
              <span class="metric-label">Total Shares</span>
              <span class="metric-value">1.24B</span>
            </div>
            <div class="metric">
              <span class="metric-label">Prev Close</span>
              <span class="metric-value">21,710.80</span>
            </div>
          </div>
        </div>
        
        <!-- Index Card 2 -->
        <div class="market-card fade-in delay-200">
          <div class="market-header">
            <h3 class="market-title">SENSEX</h3>
            <div class="market-value">
              <span class="value-number">72,256.14</span>
              <span class="change-badge positive">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
                  <polyline points="16 7 22 7 22 13"></polyline>
                </svg>
                0.67%
              </span>
            </div>
          </div>
          
          <div class="chart-container">
            <svg width="120" height="40">
              <path d="M0,32 L10,30 L20,28 L30,25 L40,23 L50,18 L60,20 L70,18 L80,15 L90,10 L100,8 L110,5 L120,3" fill="none" stroke="#10B981" stroke-width="2"></path>
            </svg>
          </div>
          
          <div class="market-metrics">
            <div class="metric">
              <span class="metric-label">Total Shares</span>
              <span class="metric-value">937.5M</span>
            </div>
            <div class="metric">
              <span class="metric-label">Prev Close</span>
              <span class="metric-value">71,788.04</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Popular Stocks -->
      <h2 class="section-title">Most Popular This Week</h2>
      <div class="popular-stocks fade-in delay-300">
        <!-- Stock Card 1 -->
        <div class="stock-card">
          <div class="stock-header">
            <div class="stock-logo">A</div>
            <div class="stock-info">
              <span class="stock-name">Apple Inc.</span>
              <span class="stock-ticker">AAPL</span>
            </div>
          </div>
          
          <div class="stock-price">
            <span class="price-value">$172.62</span>
            <span class="change-badge positive">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
                <polyline points="16 7 22 7 22 13"></polyline>
              </svg>
              1.23%
            </span>
          </div>
        </div>
        
        <!-- Stock Card 2 -->
        <div class="stock-card">
          <div class="stock-header">
            <div class="stock-logo">M</div>
            <div class="stock-info">
              <span class="stock-name">Microsoft</span>
              <span class="stock-ticker">MSFT</span>
            </div>
          </div>
          
          <div class="stock-price">
            <span class="price-value">$413.64</span>
            <span class="change-badge positive">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
                <polyline points="16 7 22 7 22 13"></polyline>
              </svg>
              0.87%
            </span>
          </div>
        </div>
        
        <!-- Stock Card 3 -->
        <div class="stock-card">
          <div class="stock-header">
            <div class="stock-logo">G</div>
            <div class="stock-info">
              <span class="stock-name">Google</span>
              <span class="stock-ticker">GOOGL</span>
            </div>
          </div>
          
          <div class="stock-price">
            <span class="price-value">$139.68</span>
            <span class="change-badge negative">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="22 17 13.5 8.5 8.5 13.5 2 7"></polyline>
                <polyline points="16 17 22 17 22 11"></polyline>
              </svg>
              0.32%
            </span>
          </div>
        </div>
        
        <!-- Stock Card 4 -->
        <div class="stock-card">
          <div class="stock-header">
            <div class="stock-logo">A</div>
            <div class="stock-info">
              <span class="stock-name">Amazon</span>
              <span class="stock-ticker">AMZN</span>
            </div>
          </div>
          
          <div class="stock-price">
            <span class="price-value">$176.85</span>
            <span class="change-badge positive">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
                <polyline points="16 7 22 7 22 13"></polyline>
              </svg>
              1.86%
            </span>
          </div>
        </div>
      </div>
      
      <!-- Transactions -->
      <h2 class="section-title">Transactions</h2>
      <div class="transactions fade-in delay-400">
        <!-- Transaction 1 -->
        <div class="transaction-item">
          <div class="transaction-details">
            <div class="transaction-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m6 9 6 6 6-6"></path>
              </svg>
            </div>
            <div class="transaction-info">
              <span class="transaction-title">Bought AAPL</span>
              <span class="transaction-date">Today, 10:45 AM</span>
            </div>
          </div>
          <span class="transaction-amount positive">+$1,256.88</span>
        </div>
        
        <!-- Transaction 2 -->
        <div class="transaction-item">
          <div class="transaction-details">
            <div class="transaction-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m6 15 6-6 6 6"></path>
              </svg>
            </div>
            <div class="transaction-info">
              <span class="transaction-title">Sold TSLA</span>
              <span class="transaction-date">Yesterday, 03:20 PM</span>
            </div>
          </div>
          <span class="transaction-amount negative">-$2,897.45</span>
        </div>
        
        <!-- Transaction 3 -->
        <div class="transaction-item">
          <div class="transaction-details">
            <div class="transaction-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m6 9 6 6 6-6"></path>
              </svg>
            </div>
            <div class="transaction-info">
              <span class="transaction-title">Bought MSFT</span>
              <span class="transaction-date">Jul 12, 2023</span>
            </div>
          </div>
          <span class="transaction-amount positive">+$3,564.70</span>
        </div>
        
        <!-- Transaction 4 -->
        <div class="transaction-item">
          <div class="transaction-details">
            <div class="transaction-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m6 9 6 6 6-6"></path>
              </svg>
            </div>
            <div class="transaction-info">
              <span class="transaction-title">Deposit</span>
              <span class="transaction-date">Jul 10, 2023</span>
            </div>
          </div>
          <span class="transaction-amount positive">+$10,000.00</span>
        </div>
        
        <a href="#" class="view-all">View All Transactions</a>
      </div>
    </div>
    
    <!-- News Sidebar -->
    <aside class="news-sidebar">
      <div class="news-header">
        <h2 class="news-title">Market News</h2>
      </div>
      
      <div class="news-list">
        <!-- News Item 1 -->
        <div class="news-item">
          <div class="news-meta">
            <span class="news-source">Bloomberg</span>
            <span class="news-time">2h ago</span>
          </div>
          <h3 class="news-headline">Tech Stocks Lead Market Rally as Inflation Cools</h3>
          <p class="news-snippet">Technology shares led gains in stocks on Thursday after data showed US inflation continued to cool, boosting speculation the Federal Reserve will cut interest rates this year.</p>
        </div>
        
        <!-- News Item 2 -->
        <div class="news-item">
          <div class="news-meta">
            <span class="news-source">CNBC</span>
            <span class="news-time">5h ago</span>
          </div>
          <h3 class="news-headline">Oil Prices Fall on Demand Concerns Despite Mideast Tension</h3>
          <p class="news-snippet">Oil prices fell on Wednesday as a larger-than-expected rise in US crude inventories and a stronger dollar offset the impact of escalating tensions in the Middle East.</p>
        </div>
        
        <!-- News Item 3 -->
        <div class="news-item">
          <div class="news-meta">
            <span class="news-source">Reuters</span>
            <span class="news-time">6h ago</span>
          </div>
          <h3 class="news-headline">Apple Unveils New AI Features for iPhone, Stock Surges</h3>
          <p class="news-snippet">Apple Inc introduced new artificial intelligence features for the iPhone and other devices on Monday, taking its first major step into the technology that has swept the industry.</p>
        </div>
        
        <!-- News Item 4 -->
        <div class="news-item">
          <div class="news-meta">
            <span class="news-source">Financial Times</span>
            <span class="news-time">1d ago</span>
          </div>
          <h3 class="news-headline">Fed Officials Signal Patience on Rate Cuts After Strong Jobs Data</h3>
          <p class="news-snippet">Federal Reserve officials signaled they are in no rush to cut interest rates after data showed the US economy added more jobs than expected in May, suggesting resilience despite high borrowing costs.</p>
        </div>
      </div>
      
      <div class="news-footer">
        <a href="#">View All News</a>
      </div>
    </aside>
  </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // API key for Alpha Vantage - Replace with your own key
      const API_KEY = 'XQWN10RE8LHM3UXM';
      
      // Toast notification system
      const toastContainer = document.getElementById('toast-container');
      
      function showToast(message, type = 'info', duration = 5000) {
        console.log(`Toast: ${type} - ${message}`);
        
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        let iconSvg = '';
        switch(type) {
          case 'success':
            iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" class="toast-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>';
            break;
          case 'error':
            iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" class="toast-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>';
            break;
          case 'warning':
            iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" class="toast-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>';
            break;
          default:
            iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" class="toast-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>';
        }
        
        toast.innerHTML = `
          ${iconSvg}
          <span class="toast-message">${message}</span>
        `;
        
        toastContainer.appendChild(toast);
        
        // Remove toast after duration
        setTimeout(() => {
          toast.style.animation = 'slideOut 0.3s forwards';
          setTimeout(() => {
            toastContainer.removeChild(toast);
          }, 300);
        }, duration);
      }
      
      // Function to update API status UI
      function updateApiStatus(status, message) {
        const apiStatusElement = document.getElementById('apiStatus');
        const retryButton = document.getElementById('retryButton');
        
        apiStatusElement.className = `api-status ${status}`;
        
        let iconSvg = '';
        switch(status) {
          case 'loading':
            iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" class="api-status-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg>';
            break;
          case 'success':
            iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" class="api-status-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>';
            break;
          case 'error':
            iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" class="api-status-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>';
            break;
        }
        
        apiStatusElement.innerHTML = `
          ${iconSvg}
          <span>${message}</span>
          ${status === 'error' ? retryButton.outerHTML : ''}
        `;
        
        // Re-attach event listener if the button was recreated
        if (status === 'error') {
          document.getElementById('retryButton').addEventListener('click', function() {
            loadStockData();
          });
        }
      }
      
      // Function to fetch stock data with better error handling
      async function fetchStockData(symbol) {
        try {
          console.log(`Fetching stock data for ${symbol}...`);
          
          const apiUrl = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${API_KEY}`;
          console.log("API URL:", apiUrl);
          
          const response = await fetch(apiUrl);
          
          if (!response.ok) {
            throw new Error(`API responded with status: ${response.status}`);
          }
          
          const data = await response.json();
          console.log(`Response for ${symbol}:`, data);
          
          // Check for API limit messages
          if (data["Note"]) {
            console.warn("API limit reached:", data["Note"]);
            throw new Error("API call frequency limit reached. Please try again later.");
          }
          
          // Check for error response or empty data
          if (data["Error Message"] || !data["Global Quote"]) {
            throw new Error("Failed to fetch stock data");
          }
          
          const quote = data["Global Quote"];
          if (Object.keys(quote).length === 0) {
            throw new Error("Empty quote data received");
          }
          
          return {
            symbol: quote["01. symbol"],
            price: parseFloat(quote["05. price"]),
            change: parseFloat(quote["09. change"]),
            changePercent: parseFloat(quote["10. change percent"].replace('%', ''))
          };
        } catch (error) {
          console.error(`Error fetching data for ${symbol}:`, error);
          throw error;
        }
      }
      
      // Function to update a stock card with real data
      function updateStockCard(cardIndex, stockData) {
        if (!stockData) return;
        
        const stockCards = document.querySelectorAll('.stock-card');
        if (cardIndex >= stockCards.length) return;
        
        const card = stockCards[cardIndex];
        const priceElement = card.querySelector('.price-value');
        const changeElement = card.querySelector('.change-badge');
        const changeIcon = changeElement.querySelector('svg');
        
        // Update price
        priceElement.textContent = `$${stockData.price.toFixed(2)}`;
        
        // Update change percentage and color
        const isPositive = stockData.changePercent >= 0;
        changeElement.className = `change-badge ${isPositive ? 'positive' : 'negative'}`;
        
        // Update change icon
        if (isPositive) {
          changeIcon.innerHTML = '<polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline>';
        } else {
          changeIcon.innerHTML = '<polyline points="22 17 13.5 8.5 8.5 13.5 2 7"></polyline><polyline points="16 17 22 17 22 11"></polyline>';
        }
        
        // Update change percentage text
        const percentText = changeElement.childNodes[1];
        if (percentText) {
          percentText.textContent = `${Math.abs(stockData.changePercent).toFixed(2)}%`;
        } else {
          const textNode = document.createTextNode(`${Math.abs(stockData.changePercent).toFixed(2)}%`);
          changeElement.appendChild(textNode);
        }
      }
      
      // Function to load stock data with better error handling
      async function loadStockData() {
        const symbols = ['AAPL', 'MSFT', 'GOOGL', 'AMZN'];
        let successCount = 0;
        let failureCount = 0;
        
        updateApiStatus('loading', 'Loading real-time data...');
        
        try {
          // Fetch data for all symbols with Promise.allSettled
          const results = await Promise.allSettled(
            symbols.map(symbol => fetchStockData(symbol))
          );
          
          // Process results
          results.forEach((result, index) => {
            if (result.status === 'fulfilled') {
              updateStockCard(index, result.value);
              successCount++;
            } else {
              console.error(`Failed to load ${symbols[index]}:`, result.reason);
              failureCount++;
            }
          });
          
          // Update status based on results
          if (successCount > 0) {
            if (failureCount > 0) {
              showToast(`Loaded ${successCount} of ${symbols.length} stocks. Some data couldn't be updated.`, 'warning');
              updateApiStatus('success', 'Partial real-time data loaded.');
            } else {
              showToast('Successfully loaded all real-time stock data', 'success');
              updateApiStatus('success', 'Using real-time market data');
              
              // Auto-hide success message after 5 seconds
              setTimeout(() => {
                const apiStatus = document.getElementById('apiStatus');
                if (apiStatus.classList.contains('success')) {
                  apiStatus.style.display = 'none';
                }
              }, 5000);
            }
          } else {
            throw new Error('Failed to load any stock data');
          }
        } catch (error) {
          console.error('Error loading stock data:', error);
          
          // Handle specific API errors
          if (error.message.includes('frequency limit')) {
            showToast('API call limit reached. Please try again later.', 'warning');
            updateApiStatus('error', 'API limit reached. Using fallback data.');
          } else {
            showToast('Failed to load real-time data. Using fallback data.', 'error');
            updateApiStatus('error', 'Using fallback data. Real-time data not available.');
          }
        }
      }
      
      // Add retry button event listener
      document.getElementById('retryButton').addEventListener('click', function() {
        showToast('Retrying API connection...', 'info');
        loadStockData();
      });
      
      // Add search functionality
      const searchInput = document.querySelector('.search-input');
      searchInput.addEventListener('keyup', function(event) {
        if (event.key === 'Enter') {
          const searchQuery = this.value.trim().toLowerCase();
          if (searchQuery) {
            showToast(`Searching for: ${searchQuery}`, 'info');
            // Implement your search logic here
          }
        }
      });
      
      // Add click events to navigation links
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach(link => {
        link.addEventListener('click', function() {
          navLinks.forEach(l => l.classList.remove('active'));
          this.classList.add('active');
        });
      });
      
      // Load stock data when the page loads
      loadStockData();
    });
  </script>
</body>
</html>
